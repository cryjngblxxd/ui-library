--[[
    Complete UI Library for Roblox
    Features: Colorpickers, Sliders, Toggles, Dropdowns, Graphs, Notifications, Themes, Configs
    Author: AI Recreation
]]

local Library = {}
Library.__index = Library

-- Services
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local HttpService = game:GetService("HttpService")
local Players = game:GetService("Players")

local Player = Players.LocalPlayer
local Mouse = Player:GetMouse()

-- Constants
local FONT = Enum.Font.Gotham
local FONT_BOLD = Enum.Font.GothamBold
local FONT_SEMIBOLD = Enum.Font.GothamSemibold

-- Default Theme
Library.Theme = {
    Background = Color3.fromRGB(15, 15, 15),
    SecondaryBackground = Color3.fromRGB(20, 20, 20),
    TertiaryBackground = Color3.fromRGB(25, 25, 25),
    ElementBackground = Color3.fromRGB(30, 30, 30),
    ElementBackgroundHover = Color3.fromRGB(35, 35, 35),
    Border = Color3.fromRGB(40, 40, 40),
    Text = Color3.fromRGB(255, 255, 255),
    TextDark = Color3.fromRGB(150, 150, 150),
    TextDarker = Color3.fromRGB(100, 100, 100),
    Accent = Color3.fromRGB(100, 180, 255),
    AccentGreen = Color3.fromRGB(146, 255, 155),
    AccentRed = Color3.fromRGB(255, 100, 100),
    SliderFill = Color3.fromRGB(100, 180, 255),
    ToggleOn = Color3.fromRGB(146, 255, 155),
    ToggleOff = Color3.fromRGB(60, 60, 60),
    Shadow = Color3.fromRGB(0, 0, 0),
    Notification = Color3.fromRGB(20, 20, 20),
    GraphLine = Color3.fromRGB(100, 180, 255),
    GraphAxis = Color3.fromRGB(60, 60, 60),
    CornerRadius = 5,
    ShadowTransparency = 0.7
}

-- Config System
Library.Configs = {}
Library.CurrentConfig = nil
Library.AutoLoadConfig = nil

-- Utility Functions
local function Create(className, properties, children)
    local instance = Instance.new(className)
    for prop, value in pairs(properties or {}) do
        instance[prop] = value
    end
    for _, child in ipairs(children or {}) do
        child.Parent = instance
    end
    return instance
end

local function Tween(instance, properties, duration, style, direction)
    local tween = TweenService:Create(
        instance,
        TweenInfo.new(duration or 0.2, style or Enum.EasingStyle.Quad, direction or Enum.EasingDirection.Out),
        properties
    )
    tween:Play()
    return tween
end

local function AddCorner(parent, radius)
    return Create("UICorner", {
        CornerRadius = UDim.new(0, radius or Library.Theme.CornerRadius),
        Parent = parent
    })
end

local function AddStroke(parent, color, thickness)
    return Create("UIStroke", {
        Color = color or Library.Theme.Border,
        Thickness = thickness or 1,
        Parent = parent
    })
end

local function AddShadow(parent)
    local shadow = Create("ImageLabel", {
        Name = "Shadow",
        BackgroundTransparency = 1,
        Position = UDim2.new(0, -15, 0, -15),
        Size = UDim2.new(1, 30, 1, 30),
        ZIndex = -1,
        Image = "rbxassetid://6015897843",
        ImageColor3 = Library.Theme.Shadow,
        ImageTransparency = Library.Theme.ShadowTransparency,
        ScaleType = Enum.ScaleType.Slice,
        SliceCenter = Rect.new(49, 49, 450, 450),
        Parent = parent
    })
    return shadow
end

local function RGBToHSV(color)
    local r, g, b = color.R, color.G, color.B
    local max, min = math.max(r, g, b), math.min(r, g, b)
    local h, s, v = 0, 0, max
    
    local d = max - min
    s = max == 0 and 0 or d / max
    
    if max ~= min then
        if max == r then
            h = (g - b) / d + (g < b and 6 or 0)
        elseif max == g then
            h = (b - r) / d + 2
        else
            h = (r - g) / d + 4
        end
        h = h / 6
    end
    
    return h, s, v
end

local function HSVToRGB(h, s, v)
    local r, g, b
    local i = math.floor(h * 6)
    local f = h * 6 - i
    local p = v * (1 - s)
    local q = v * (1 - f * s)
    local t = v * (1 - (1 - f) * s)
    
    i = i % 6
    
    if i == 0 then r, g, b = v, t, p
    elseif i == 1 then r, g, b = q, v, p
    elseif i == 2 then r, g, b = p, v, t
    elseif i == 3 then r, g, b = p, q, v
    elseif i == 4 then r, g, b = t, p, v
    elseif i == 5 then r, g, b = v, p, q
    end
    
    return Color3.new(r, g, b)
end

local function ColorToHex(color)
    return string.format("#%02X%02X%02X", 
        math.floor(color.R * 255), 
        math.floor(color.G * 255), 
        math.floor(color.B * 255)
    )
end

local function HexToColor(hex)
    hex = hex:gsub("#", "")
    return Color3.fromRGB(
        tonumber(hex:sub(1, 2), 16) or 0,
        tonumber(hex:sub(3, 4), 16) or 0,
        tonumber(hex:sub(5, 6), 16) or 0
    )
end

-- Main Library
function Library.new(title, version)
    local self = setmetatable({}, Library)
    
    self.Title = title or ".gg/robloxuis"
    self.Version = version or "version"
    self.Windows = {}
    self.Notifications = {}
    self.Tooltips = {}
    self.Elements = {}
    self.Connections = {}
    self.Flags = {}
    
    -- Create ScreenGui
    self.ScreenGui = Create("ScreenGui", {
        Name = "UILibrary",
        ResetOnSpawn = false,
        ZIndexBehavior = Enum.ZIndexBehavior.Sibling,
        Parent = game:GetService("CoreGui")
    })
    
    -- Notification Container
    self.NotificationContainer = Create("Frame", {
        Name = "Notifications",
        BackgroundTransparency = 1,
        Position = UDim2.new(1, -320, 0, 20),
        Size = UDim2.new(0, 300, 1, -40),
        Parent = self.ScreenGui
    })
    
    Create("UIListLayout", {
        Padding = UDim.new(0, 10),
        SortOrder = Enum.SortOrder.LayoutOrder,
        VerticalAlignment = Enum.VerticalAlignment.Top,
        Parent = self.NotificationContainer
    })
    
    -- Tooltip Container
    self.TooltipContainer = Create("Frame", {
        Name = "Tooltips",
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 1, 0),
        ZIndex = 100,
        Parent = self.ScreenGui
    })
    
    return self
end

-- Create Main Window
function Library:CreateWindow(options)
    options = options or {}
    local title = options.Title or self.Title
    local size = options.Size or UDim2.new(0, 700, 0, 500)
    local position = options.Position or UDim2.new(0.5, -350, 0.5, -250)
    
    local window = {}
    window.Tabs = {}
    window.CurrentTab = nil
    
    -- Main Container
    window.Container = Create("Frame", {
        Name = "Window",
        BackgroundColor3 = Library.Theme.Background,
        Position = position,
        Size = size,
        Parent = self.ScreenGui
    })
    AddCorner(window.Container, 8)
    AddShadow(window.Container)
    
    -- Top Bar
    window.TopBar = Create("Frame", {
        Name = "TopBar",
        BackgroundColor3 = Library.Theme.SecondaryBackground,
        Size = UDim2.new(1, 0, 0, 40),
        Parent = window.Container
    })
    AddCorner(window.TopBar, 8)
    
    -- Fix corner for top bar (only round top corners)
    Create("Frame", {
        Name = "BottomFix",
        BackgroundColor3 = Library.Theme.SecondaryBackground,
        Position = UDim2.new(0, 0, 1, -8),
        Size = UDim2.new(1, 0, 0, 8),
        BorderSizePixel = 0,
        Parent = window.TopBar
    })
    
    -- Title
    window.TitleLabel = Create("TextLabel", {
        Name = "Title",
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 50, 0, 0),
        Size = UDim2.new(0, 150, 1, 0),
        Font = FONT_SEMIBOLD,
        Text = title,
        TextColor3 = Library.Theme.Text,
        TextSize = 14,
        TextXAlignment = Enum.TextXAlignment.Left,
        Parent = window.TopBar
    })
    
    -- Version
    window.VersionLabel = Create("TextLabel", {
        Name = "Version",
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 200, 0, 0),
        Size = UDim2.new(0, 60, 1, 0),
        Font = FONT,
        Text = self.Version,
        TextColor3 = Library.Theme.TextDark,
        TextSize = 12,
        TextXAlignment = Enum.TextXAlignment.Left,
        Parent = window.TopBar
    })
    
    -- Search Bar
    window.SearchContainer = Create("Frame", {
        Name = "SearchContainer",
        BackgroundColor3 = Library.Theme.ElementBackground,
        Position = UDim2.new(0, 270, 0.5, -12),
        Size = UDim2.new(0, 200, 0, 24),
        Parent = window.TopBar
    })
    AddCorner(window.SearchContainer, 4)
    
    window.SearchBox = Create("TextBox", {
        Name = "SearchBox",
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 8, 0, 0),
        Size = UDim2.new(1, -16, 1, 0),
        Font = FONT,
        PlaceholderText = "Search..",
        PlaceholderColor3 = Library.Theme.TextDarker,
        Text = "",
        TextColor3 = Library.Theme.Text,
        TextSize = 12,
        TextXAlignment = Enum.TextXAlignment.Left,
        ClearTextOnFocus = false,
        Parent = window.SearchContainer
    })
    
    -- Left Icon Bar
    window.IconBar = Create("Frame", {
        Name = "IconBar",
        BackgroundColor3 = Library.Theme.SecondaryBackground,
        Position = UDim2.new(0, 0, 0, 40),
        Size = UDim2.new(0, 44, 1, -40),
        Parent = window.Container
    })
    AddCorner(window.IconBar, 8)
    
    Create("Frame", {
        Name = "RightFix",
        BackgroundColor3 = Library.Theme.SecondaryBackground,
        Position = UDim2.new(1, -8, 0, 0),
        Size = UDim2.new(0, 8, 1, 0),
        BorderSizePixel = 0,
        Parent = window.IconBar
    })
    
    Create("Frame", {
        Name = "TopFix",
        BackgroundColor3 = Library.Theme.SecondaryBackground,
        Position = UDim2.new(0, 0, 0, 0),
        Size = UDim2.new(1, 0, 0, 8),
        BorderSizePixel = 0,
        Parent = window.IconBar
    })
    
    -- Icon Container
    window.IconContainer = Create("Frame", {
        Name = "IconContainer",
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 0, 0, 10),
        Size = UDim2.new(1, 0, 1, -20),
        Parent = window.IconBar
    })
    
    Create("UIListLayout", {
        Padding = UDim.new(0, 8),
        HorizontalAlignment = Enum.HorizontalAlignment.Center,
        SortOrder = Enum.SortOrder.LayoutOrder,
        Parent = window.IconContainer
    })
    
    -- Add Icons
    local iconImages = {
        "rbxassetid://7733960981", -- Home
        "rbxassetid://7734053495", -- Folder
        "rbxassetid://7734068243", -- Star
        "rbxassetid://7734057056"  -- Settings
    }
    
    for i, iconId in ipairs(iconImages) do
        local iconBtn = Create("ImageButton", {
            Name = "Icon" .. i,
            BackgroundColor3 = Library.Theme.ElementBackground,
            BackgroundTransparency = 1,
            Size = UDim2.new(0, 32, 0, 32),
            Image = iconId,
            ImageColor3 = Library.Theme.TextDark,
            LayoutOrder = i,
            Parent = window.IconContainer
        })
        AddCorner(iconBtn, 6)
        
        iconBtn.MouseEnter:Connect(function()
            Tween(iconBtn, {BackgroundTransparency = 0, ImageColor3 = Library.Theme.Text}, 0.2)
        end)
        
        iconBtn.MouseLeave:Connect(function()
            Tween(iconBtn, {BackgroundTransparency = 1, ImageColor3 = Library.Theme.TextDark}, 0.2)
        end)
    end
    
    -- Content Area
    window.ContentArea = Create("Frame", {
        Name = "ContentArea",
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 54, 0, 50),
        Size = UDim2.new(1, -64, 1, -60),
        ClipsDescendants = true,
        Parent = window.Container
    })
    
    -- Tab Container (Two Column Layout)
    window.ColumnLeft = Create("ScrollingFrame", {
        Name = "ColumnLeft",
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 0, 0, 0),
        Size = UDim2.new(0.5, -5, 1, 0),
        CanvasSize = UDim2.new(0, 0, 0, 0),
        ScrollBarThickness = 3,
        ScrollBarImageColor3 = Library.Theme.Border,
        AutomaticCanvasSize = Enum.AutomaticSize.Y,
        Parent = window.ContentArea
    })
    
    Create("UIListLayout", {
        Padding = UDim.new(0, 10),
        SortOrder = Enum.SortOrder.LayoutOrder,
        Parent = window.ColumnLeft
    })
    
    Create("UIPadding", {
        PaddingRight = UDim.new(0, 5),
        Parent = window.ColumnLeft
    })
    
    window.ColumnRight = Create("ScrollingFrame", {
        Name = "ColumnRight",
        BackgroundTransparency = 1,
        Position = UDim2.new(0.5, 5, 0, 0),
        Size = UDim2.new(0.5, -5, 1, 0),
        CanvasSize = UDim2.new(0, 0, 0, 0),
        ScrollBarThickness = 3,
        ScrollBarImageColor3 = Library.Theme.Border,
        AutomaticCanvasSize = Enum.AutomaticSize.Y,
        Parent = window.ContentArea
    })
    
    Create("UIListLayout", {
        Padding = UDim.new(0, 10),
        SortOrder = Enum.SortOrder.LayoutOrder,
        Parent = window.ColumnRight
    })
    
    Create("UIPadding", {
        PaddingLeft = UDim.new(0, 5),
        Parent = window.ColumnRight
    })
    
    -- Dragging
    local dragging, dragStart, startPos
    
    window.TopBar.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = window.Container.Position
        end
    end)
    
    window.TopBar.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = false
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            local delta = input.Position - dragStart
            window.Container.Position = UDim2.new(
                startPos.X.Scale, startPos.X.Offset + delta.X,
                startPos.Y.Scale, startPos.Y.Offset + delta.Y
            )
        end
    end)
    
    -- Create Section Function
    function window:CreateSection(options)
        options = options or {}
        local name = options.Name or "Section"
        local side = options.Side or "Left"
        local hasTabs = options.Tabs
        
        local section = {}
        section.Elements = {}
        
        local parent = side == "Left" and window.ColumnLeft or window.ColumnRight
        
        section.Container = Create("Frame", {
            Name = name,
            BackgroundColor3 = Library.Theme.SecondaryBackground,
            Size = UDim2.new(1, 0, 0, 0),
            AutomaticSize = Enum.AutomaticSize.Y,
            Parent = parent
        })
        AddCorner(section.Container, 6)
        AddStroke(section.Container, Library.Theme.Border, 1)
        
        -- Header
        section.Header = Create("Frame", {
            Name = "Header",
            BackgroundTransparency = 1,
            Size = UDim2.new(1, 0, 0, 30),
            Parent = section.Container
        })
        
        section.HeaderLabel = Create("TextLabel", {
            Name = "HeaderLabel",
            BackgroundTransparency = 1,
            Position = UDim2.new(0, 12, 0, 0),
            Size = UDim2.new(1, -24, 1, 0),
            Font = FONT_SEMIBOLD,
            Text = name,
            TextColor3 = Library.Theme.Text,
            TextSize = 13,
            TextXAlignment = Enum.TextXAlignment.Left,
            Parent = section.Header
        })
        
        -- Tab Bar (if tabs exist)
        if hasTabs then
            section.TabBar = Create("Frame", {
                Name = "TabBar",
                BackgroundTransparency = 1,
                Position = UDim2.new(0, 12, 0, 30),
                Size = UDim2.new(1, -24, 0, 30),
                Parent = section.Container
            })
            
            Create("UIListLayout", {
                FillDirection = Enum.FillDirection.Horizontal,
                Padding = UDim.new(0, 6),
                SortOrder = Enum.SortOrder.LayoutOrder,
                Parent = section.TabBar
            })
            
            section.Tabs = {}
            section.TabContents = {}
            section.CurrentTab = nil
            
            for i, tabName in ipairs(hasTabs) do
                local tabBtn = Create("Frame", {
                    Name = tabName,
                    BackgroundColor3 = Library.Theme.ElementBackground,
                    Size = UDim2.new(0, 26, 0, 26),
                    LayoutOrder = i,
                    Parent = section.TabBar
                })
                AddCorner(tabBtn, 13)
                
                local tabIcon = Create("ImageLabel", {
                    Name = "Icon",
                    BackgroundTransparency = 1,
                    Position = UDim2.new(0.5, -8, 0.5, -8),
                    Size = UDim2.new(0, 16, 0, 16),
                    Image = "rbxassetid://7733960981",
                    ImageColor3 = Library.Theme.TextDark,
                    Parent = tabBtn
                })
                
                local tabContent = Create("Frame", {
                    Name = tabName .. "Content",
                    BackgroundTransparency = 1,
                    Position = UDim2.new(0, 0, 0, 70),
                    Size = UDim2.new(1, 0, 0, 0),
                    AutomaticSize = Enum.AutomaticSize.Y,
                    Visible = i == 1,
                    Parent = section.Container
                })
                
                Create("UIListLayout", {
                    Padding = UDim.new(0, 8),
                    SortOrder = Enum.SortOrder.LayoutOrder,
                    Parent = tabContent
                })
                
                Create("UIPadding", {
                    PaddingLeft = UDim.new(0, 12),
                    PaddingRight = UDim.new(0, 12),
                    PaddingBottom = UDim.new(0, 12),
                    Parent = tabContent
                })
                
                section.Tabs[tabName] = tabBtn
                section.TabContents[tabName] = tabContent
                
                if i == 1 then
                    section.CurrentTab = tabName
                    Tween(tabBtn, {BackgroundColor3 = Library.Theme.Accent}, 0.2)
                    Tween(tabIcon, {ImageColor3 = Library.Theme.Text}, 0.2)
                end
                
                local btn = Create("TextButton", {
                    Name = "Button",
                    BackgroundTransparency = 1,
                    Size = UDim2.new(1, 0, 1, 0),
                    Text = "",
                    Parent = tabBtn
                })
                
                btn.MouseButton1Click:Connect(function()
                    if section.CurrentTab ~= tabName then
                        -- Hide current
                        if section.CurrentTab then
                            section.TabContents[section.CurrentTab].Visible = false
                            local oldTab = section.Tabs[section.CurrentTab]
                            Tween(oldTab, {BackgroundColor3 = Library.Theme.ElementBackground}, 0.2)
                            Tween(oldTab.Icon, {ImageColor3 = Library.Theme.TextDark}, 0.2)
                        end
                        
                        -- Show new
                        section.CurrentTab = tabName
                        tabContent.Visible = true
                        Tween(tabBtn, {BackgroundColor3 = Library.Theme.Accent}, 0.2)
                        Tween(tabIcon, {ImageColor3 = Library.Theme.Text}, 0.2)
                    end
                end)
                
                btn.MouseEnter:Connect(function()
                    if section.CurrentTab ~= tabName then
                        Tween(tabBtn, {BackgroundColor3 = Library.Theme.ElementBackgroundHover}, 0.2)
                    end
                end)
                
                btn.MouseLeave:Connect(function()
                    if section.CurrentTab ~= tabName then
                        Tween(tabBtn, {BackgroundColor3 = Library.Theme.ElementBackground}, 0.2)
                    end
                end)
            end
        end
        
        -- Content Container
        section.Content = Create("Frame", {
            Name = "Content",
            BackgroundTransparency = 1,
            Position = UDim2.new(0, 0, 0, hasTabs and 70 or 30),
            Size = UDim2.new(1, 0, 0, 0),
            AutomaticSize = Enum.AutomaticSize.Y,
            Parent = section.Container
        })
        
        Create("UIListLayout", {
            Padding = UDim.new(0, 8),
            SortOrder = Enum.SortOrder.LayoutOrder,
            Parent = section.Content
        })
        
        Create("UIPadding", {
            PaddingLeft = UDim.new(0, 12),
            PaddingRight = UDim.new(0, 12),
            PaddingBottom = UDim.new(0, 12),
            Parent = section.Content
        })
        
        -- Add Toggle
        function section:AddToggle(options)
            options = options or {}
            local name = options.Name or "Toggle"
            local default = options.Default or false
            local callback = options.Callback or function() end
            local flag = options.Flag
            
            local toggle = {}
            toggle.Value = default
            
            toggle.Container = Create("Frame", {
                Name = name,
                BackgroundTransparency = 1,
                Size = UDim2.new(1, 0, 0, 24),
                Parent = section.Content
            })
            
            toggle.Box = Create("Frame", {
                Name = "Box",
                BackgroundColor3 = default and Library.Theme.ToggleOn or Library.Theme.ToggleOff,
                Position = UDim2.new(0, 0, 0.5, -8),
                Size = UDim2.new(0, 32, 0, 16),
                Parent = toggle.Container
            })
            AddCorner(toggle.Box, 8)
            
            toggle.Circle = Create("Frame", {
                Name = "Circle",
                BackgroundColor3 = Library.Theme.Text,
                Position = default and UDim2.new(1, -14, 0.5, -6) or UDim2.new(0, 2, 0.5, -6),
                Size = UDim2.new(0, 12, 0, 12),
                Parent = toggle.Box
            })
            AddCorner(toggle.Circle, 6)
            
            toggle.Label = Create("TextLabel", {
                Name = "Label",
                BackgroundTransparency = 1,
                Position = UDim2.new(0, 42, 0, 0),
                Size = UDim2.new(1, -42, 1, 0),
                Font = FONT,
                Text = name,
                TextColor3 = Library.Theme.Text,
                TextSize = 12,
                TextXAlignment = Enum.TextXAlignment.Left,
                Parent = toggle.Container
            })
            
            local button = Create("TextButton", {
                Name = "Button",
                BackgroundTransparency = 1,
                Size = UDim2.new(1, 0, 1, 0),
                Text = "",
                Parent = toggle.Container
            })
            
            function toggle:Set(value)
                toggle.Value = value
                Tween(toggle.Box, {BackgroundColor3 = value and Library.Theme.ToggleOn or Library.Theme.ToggleOff}, 0.2)
                Tween(toggle.Circle, {Position = value and UDim2.new(1, -14, 0.5, -6) or UDim2.new(0, 2, 0.5, -6)}, 0.2)
                callback(value)
            end
            
            button.MouseButton1Click:Connect(function()
                toggle:Set(not toggle.Value)
            end)
            
            if flag then
                Library.Flags[flag] = toggle
            end
            
            section.Elements[name] = toggle
            return toggle
        end
        
        -- Add Slider
        function section:AddSlider(options)
            options = options or {}
            local name = options.Name or "Slider"
            local min = options.Min or 0
            local max = options.Max or 1
            local default = options.Default or min
            local increment = options.Increment or 0.1
            local suffix = options.Suffix or "s"
            local callback = options.Callback or function() end
            local flag = options.Flag
            
            local slider = {}
            slider.Value = default
            
            slider.Container = Create("Frame", {
                Name = name,
                BackgroundTransparency = 1,
                Size = UDim2.new(1, 0, 0, 36),
                Parent = section.Content
            })
            
            slider.Label = Create("TextLabel", {
                Name = "Label",
                BackgroundTransparency = 1,
                Size = UDim2.new(1, -50, 0, 16),
                Font = FONT,
                Text = name,
                TextColor3 = Library.Theme.Text,
                TextSize = 12,
                TextXAlignment = Enum.TextXAlignment.Left,
                Parent = slider.Container
            })
            
            slider.ValueLabel = Create("TextLabel", {
                Name = "Value",
                BackgroundTransparency = 1,
                Position = UDim2.new(1, -50, 0, 0),
                Size = UDim2.new(0, 50, 0, 16),
                Font = FONT,
                Text = string.format("%.1f%s", default, suffix),
                TextColor3 = Library.Theme.TextDark,
                TextSize = 12,
                TextXAlignment = Enum.TextXAlignment.Right,
                Parent = slider.Container
            })
            
            slider.Track = Create("Frame", {
                Name = "Track",
                BackgroundColor3 = Library.Theme.ElementBackground,
                Position = UDim2.new(0, 0, 0, 22),
                Size = UDim2.new(1, 0, 0, 10),
                Parent = slider.Container
            })
            AddCorner(slider.Track, 5)
            
            local fillPercent = (default - min) / (max - min)
            slider.Fill = Create("Frame", {
                Name = "Fill",
                BackgroundColor3 = Library.Theme.SliderFill,
                Size = UDim2.new(fillPercent, 0, 1, 0),
                Parent = slider.Track
            })
            AddCorner(slider.Fill, 5)
            
            slider.Knob = Create("Frame", {
                Name = "Knob",
                BackgroundColor3 = Library.Theme.Text,
                Position = UDim2.new(fillPercent, -6, 0.5, -6),
                Size = UDim2.new(0, 12, 0, 12),
                ZIndex = 2,
                Parent = slider.Track
            })
            AddCorner(slider.Knob, 6)
            
            function slider:Set(value)
                value = math.clamp(value, min, max)
                value = math.floor(value / increment + 0.5) * increment
                slider.Value = value
                
                local percent = (value - min) / (max - min)
                Tween(slider.Fill, {Size = UDim2.new(percent, 0, 1, 0)}, 0.1)
                Tween(slider.Knob, {Position = UDim2.new(percent, -6, 0.5, -6)}, 0.1)
                slider.ValueLabel.Text = string.format("%.1f%s", value, suffix)
                
                callback(value)
            end
            
            local dragging = false
            
            local function updateSlider(input)
                local trackPos = slider.Track.AbsolutePosition.X
                local trackSize = slider.Track.AbsoluteSize.X
                local percent = math.clamp((input.Position.X - trackPos) / trackSize, 0, 1)
                local value = min + (max - min) * percent
                slider:Set(value)
            end
            
            slider.Track.InputBegan:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 then
                    dragging = true
                    updateSlider(input)
                end
            end)
            
            slider.Track.InputEnded:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 then
                    dragging = false
                end
            end)
            
            UserInputService.InputChanged:Connect(function(input)
                if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
                    updateSlider(input)
                end
            end)
            
            if flag then
                Library.Flags[flag] = slider
            end
            
            section.Elements[name] = slider
            return slider
        end
        
        -- Add Dropdown
        function section:AddDropdown(options)
            options = options or {}
            local name = options.Name or "Dropdown"
            local items = options.Items or {"Option 1", "Option 2", "Option 3"}
            local default = options.Default or items[1]
            local callback = options.Callback or function() end
            local flag = options.Flag
            
            local dropdown = {}
            dropdown.Value = default
            dropdown.Open = false
            
            dropdown.Container = Create("Frame", {
                Name = name,
                BackgroundTransparency = 1,
                Size = UDim2.new(1, 0, 0, 46),
                ClipsDescendants = false,
                Parent = section.Content
            })
            
            dropdown.Label = Create("TextLabel", {
                Name = "Label",
                BackgroundTransparency = 1,
                Size = UDim2.new(1, 0, 0, 16),
                Font = FONT,
                Text = name,
                TextColor3 = Library.Theme.Text,
                TextSize = 12,
                TextXAlignment = Enum.TextXAlignment.Left,
                Parent = dropdown.Container
            })
            
            dropdown.Box = Create("Frame", {
                Name = "Box",
                BackgroundColor3 = Library.Theme.ElementBackground,
                Position = UDim2.new(0, 0, 0, 20),
                Size = UDim2.new(1, 0, 0, 26),
                Parent = dropdown.Container
            })
            AddCorner(dropdown.Box, 4)
            AddStroke(dropdown.Box, Library.Theme.Border, 1)
            
            dropdown.Selected = Create("TextLabel", {
                Name = "Selected",
                BackgroundTransparency = 1,
                Position = UDim2.new(0, 10, 0, 0),
                Size = UDim2.new(1, -30, 1, 0),
                Font = FONT,
                Text = default,
                TextColor3 = Library.Theme.Text,
                TextSize = 12,
                TextXAlignment = Enum.TextXAlignment.Left,
                Parent = dropdown.Box
            })
            
            dropdown.Arrow = Create("ImageLabel", {
                Name = "Arrow",
                BackgroundTransparency = 1,
                Position = UDim2.new(1, -20, 0.5, -5),
                Size = UDim2.new(0, 10, 0, 10),
                Image = "rbxassetid://7734059790",
                ImageColor3 = Library.Theme.TextDark,
                Rotation = 0,
                Parent = dropdown.Box
            })
            
            dropdown.DropdownList = Create("Frame", {
                Name = "List",
                BackgroundColor3 = Library.Theme.ElementBackground,
                Position = UDim2.new(0, 0, 0, 50),
                Size = UDim2.new(1, 0, 0, 0),
                ClipsDescendants = true,
                Visible = false,
                ZIndex = 10,
                Parent = dropdown.Container
            })
            AddCorner(dropdown.DropdownList, 4)
            AddStroke(dropdown.DropdownList, Library.Theme.Border, 1)
            
            Create("UIListLayout", {
                Padding = UDim.new(0, 2),
                SortOrder = Enum.SortOrder.LayoutOrder,
                Parent = dropdown.DropdownList
            })
            
            Create("UIPadding", {
                PaddingTop = UDim.new(0, 4),
                PaddingBottom = UDim.new(0, 4),
                PaddingLeft = UDim.new(0, 4),
                PaddingRight = UDim.new(0, 4),
                Parent = dropdown.DropdownList
            })
            
            function dropdown:UpdateItems(newItems)
                items = newItems
                for _, child in ipairs(dropdown.DropdownList:GetChildren()) do
                    if child:IsA("TextButton") then
                        child:Destroy()
                    end
                end
                
                for i, item in ipairs(items) do
                    local itemBtn = Create("TextButton", {
                        Name = item,
                        BackgroundColor3 = Library.Theme.TertiaryBackground,
                        BackgroundTransparency = 1,
                        Size = UDim2.new(1, 0, 0, 22),
                        Font = FONT,
                        Text = item,
                        TextColor3 = Library.Theme.Text,
                        TextSize = 11,
                        LayoutOrder = i,
                        Parent = dropdown.DropdownList
                    })
                    AddCorner(itemBtn, 3)
                    
                    itemBtn.MouseEnter:Connect(function()
                        Tween(itemBtn, {BackgroundTransparency = 0}, 0.1)
                    end)
                    
                    itemBtn.MouseLeave:Connect(function()
                        Tween(itemBtn, {BackgroundTransparency = 1}, 0.1)
                    end)
                    
                    itemBtn.MouseButton1Click:Connect(function()
                        dropdown:Set(item)
                        dropdown:Toggle(false)
                    end)
                end
            end
            
            function dropdown:Set(value)
                dropdown.Value = value
                dropdown.Selected.Text = value
                callback(value)
            end
            
            function dropdown:Toggle(state)
                dropdown.Open = state ~= nil and state or not dropdown.Open
                
                if dropdown.Open then
                    dropdown.DropdownList.Visible = true
                    Tween(dropdown.DropdownList, {Size = UDim2.new(1, 0, 0, math.min(#items * 24 + 8, 120))}, 0.2)
                    Tween(dropdown.Arrow, {Rotation = 180}, 0.2)
                else
                    Tween(dropdown.DropdownList, {Size = UDim2.new(1, 0, 0, 0)}, 0.2)
                    Tween(dropdown.Arrow, {Rotation = 0}, 0.2)
                    task.delay(0.2, function()
                        if not dropdown.Open then
                            dropdown.DropdownList.Visible = false
                        end
                    end)
                end
            end
            
            dropdown:UpdateItems(items)
            
            local button = Create("TextButton", {
                Name = "Button",
                BackgroundTransparency = 1,
                Size = UDim2.new(1, 0, 1, 0),
                Text = "",
                Parent = dropdown.Box
            })
            
            button.MouseButton1Click:Connect(function()
                dropdown:Toggle()
            end)
            
            if flag then
                Library.Flags[flag] = dropdown
            end
            
            section.Elements[name] = dropdown
            return dropdown
        end
        
        -- Add Textbox
        function section:AddTextbox(options)
            options = options or {}
            local name = options.Name or "Textbox"
            local default = options.Default or ""
            local placeholder = options.Placeholder or "Placeholder text"
            local callback = options.Callback or function() end
            local flag = options.Flag
            
            local textbox = {}
            textbox.Value = default
            
            textbox.Container = Create("Frame", {
                Name = name,
                BackgroundTransparency = 1,
                Size = UDim2.new(1, 0, 0, 46),
                Parent = section.Content
            })
            
            textbox.Label = Create("TextLabel", {
                Name = "Label",
                BackgroundTransparency = 1,
                Size = UDim2.new(1, 0, 0, 16),
                Font = FONT,
                Text = name,
                TextColor3 = Library.Theme.Text,
                TextSize = 12,
                TextXAlignment = Enum.TextXAlignment.Left,
                Parent = textbox.Container
            })
            
            textbox.Box = Create("Frame", {
                Name = "Box",
                BackgroundColor3 = Library.Theme.ElementBackground,
                Position = UDim2.new(0, 0, 0, 20),
                Size = UDim2.new(1, 0, 0, 26),
                Parent = textbox.Container
            })
            AddCorner(textbox.Box, 4)
            AddStroke(textbox.Box, Library.Theme.Border, 1)
            
            textbox.Input = Create("TextBox", {
                Name = "Input",
                BackgroundTransparency = 1,
                Position = UDim2.new(0, 10, 0, 0),
                Size = UDim2.new(1, -20, 1, 0),
                Font = FONT,
                PlaceholderText = placeholder,
                PlaceholderColor3 = Library.Theme.TextDarker,
                Text = default,
                TextColor3 = Library.Theme.Text,
                TextSize = 12,
                TextXAlignment = Enum.TextXAlignment.Left,
                ClearTextOnFocus = false,
                Parent = textbox.Box
            })
            
            function textbox:Set(value)
                textbox.Value = value
                textbox.Input.Text = value
                callback(value)
            end
            
            textbox.Input:GetPropertyChangedSignal("Text"):Connect(function()
                textbox.Value = textbox.Input.Text
                callback(textbox.Input.Text)
            end)
            
            textbox.Input.Focused:Connect(function()
                Tween(textbox.Box, {BackgroundColor3 = Library.Theme.ElementBackgroundHover}, 0.2)
            end)
            
            textbox.Input.FocusLost:Connect(function()
                Tween(textbox.Box, {BackgroundColor3 = Library.Theme.ElementBackground}, 0.2)
            end)
            
            if flag then
                Library.Flags[flag] = textbox
            end
            
            section.Elements[name] = textbox
            return textbox
        end
        
        -- Add Keybind
        function section:AddKeybind(options)
            options = options or {}
            local name = options.Name or "Keybind"
            local default = options.Default or Enum.KeyCode.LeftShift
            local callback = options.Callback or function() end
            local flag = options.Flag
            
            local keybind = {}
            keybind.Value = default
            keybind.Listening = false
            
            keybind.Container = Create("Frame", {
                Name = name,
                BackgroundTransparency = 1,
                Size = UDim2.new(1, 0, 0, 24),
                Parent = section.Content
            })
            
            keybind.Label = Create("TextLabel", {
                Name = "Label",
                BackgroundTransparency = 1,
                Size = UDim2.new(1, -100, 1, 0),
                Font = FONT,
                Text = name,
                TextColor3 = Library.Theme.Text,
                TextSize = 12,
                TextXAlignment = Enum.TextXAlignment.Left,
                Parent = keybind.Container
            })
            
            keybind.Box = Create("Frame", {
                Name = "Box",
                BackgroundColor3 = Library.Theme.ElementBackground,
                Position = UDim2.new(1, -90, 0.5, -10),
                Size = UDim2.new(0, 90, 0, 20),
                Parent = keybind.Container
            })
            AddCorner(keybind.Box, 4)
            AddStroke(keybind.Box, Library.Theme.Border, 1)
            
            keybind.Text = Create("TextLabel", {
                Name = "Text",
                BackgroundTransparency = 1,
                Size = UDim2.new(1, 0, 1, 0),
                Font = FONT,
                Text = tostring(default.Name),
                TextColor3 = Library.Theme.Text,
                TextSize = 11,
                Parent = keybind.Box
            })
            
            local button = Create("TextButton", {
                Name = "Button",
                BackgroundTransparency = 1,
                Size = UDim2.new(1, 0, 1, 0),
                Text = "",
                Parent = keybind.Box
            })
            
            function keybind:Set(key)
                keybind.Value = key
                keybind.Text.Text = tostring(key.Name)
                callback(key)
            end
            
            button.MouseButton1Click:Connect(function()
                keybind.Listening = true
                keybind.Text.Text = "..."
                Tween(keybind.Box, {BackgroundColor3 = Library.Theme.Accent}, 0.2)
            end)
            
            UserInputService.InputBegan:Connect(function(input, gameProcessed)
                if keybind.Listening then
                    if input.UserInputType == Enum.UserInputType.Keyboard then
                        keybind.Listening = false
                        keybind:Set(input.KeyCode)
                        Tween(keybind.Box, {BackgroundColor3 = Library.Theme.ElementBackground}, 0.2)
                    end
                end
            end)
            
            if flag then
                Library.Flags[flag] = keybind
            end
            
            section.Elements[name] = keybind
            return keybind
        end
        
        -- Add Colorpicker (Mini)
        function section:AddColorpicker(options)
            options = options or {}
            local name = options.Name or "Colorpicker"
            local default = options.Default or Color3.fromRGB(146, 255, 155)
            local callback = options.Callback or function() end
            local flag = options.Flag
            
            local colorpicker = {}
            colorpicker.Value = default
            colorpicker.Open = false
            
            local h, s, v = RGBToHSV(default)
            colorpicker.Hue = h
            colorpicker.Sat = s
            colorpicker.Val = v
            
            colorpicker.Container = Create("Frame", {
                Name = name,
                BackgroundTransparency = 1,
                Size = UDim2.new(1, 0, 0, 24),
                ClipsDescendants = false,
                Parent = section.Content
            })
            
            colorpicker.Label = Create("TextLabel", {
                Name = "Label",
                BackgroundTransparency = 1,
                Size = UDim2.new(1, -30, 1, 0),
                Font = FONT,
                Text = name,
                TextColor3 = Library.Theme.Text,
                TextSize = 12,
                TextXAlignment = Enum.TextXAlignment.Left,
                Parent = colorpicker.Container
            })
            
            colorpicker.Preview = Create("Frame", {
                Name = "Preview",
                BackgroundColor3 = default,
                Position = UDim2.new(1, -24, 0.5, -8),
                Size = UDim2.new(0, 16, 0, 16),
                Parent = colorpicker.Container
            })
            AddCorner(colorpicker.Preview, 4)
            AddStroke(colorpicker.Preview, Library.Theme.Border, 1)
            
            -- Colorpicker Popup
            colorpicker.Popup = Create("Frame", {
                Name = "Popup",
                BackgroundColor3 = Library.Theme.SecondaryBackground,
                Position = UDim2.new(1, -200, 0, 28),
                Size = UDim2.new(0, 180, 0, 160),
                Visible = false,
                ZIndex = 20,
                Parent = colorpicker.Container
            })
            AddCorner(colorpicker.Popup, 6)
            AddStroke(colorpicker.Popup, Library.Theme.Border, 1)
            AddShadow(colorpicker.Popup)
            
            -- Saturation/Value Picker
            colorpicker.SVPicker = Create("ImageLabel", {
                Name = "SVPicker",
                BackgroundColor3 = HSVToRGB(h, 1, 1),
                Position = UDim2.new(0, 10, 0, 10),
                Size = UDim2.new(0, 130, 0, 100),
                Image = "rbxassetid://4155801252",
                ZIndex = 21,
                Parent = colorpicker.Popup
            })
            AddCorner(colorpicker.SVPicker, 4)
            
            colorpicker.SVCursor = Create("Frame", {
                Name = "Cursor",
                BackgroundColor3 = Color3.new(1, 1, 1),
                Position = UDim2.new(s, -4, 1 - v, -4),
                Size = UDim2.new(0, 8, 0, 8),
                ZIndex = 22,
                Parent = colorpicker.SVPicker
            })
            AddCorner(colorpicker.SVCursor, 4)
            AddStroke(colorpicker.SVCursor, Color3.new(0, 0, 0), 1)
            
            -- Hue Slider
            colorpicker.HueSlider = Create("Frame", {
                Name = "HueSlider",
                BackgroundColor3 = Color3.new(1, 1, 1),
                Position = UDim2.new(0, 150, 0, 10),
                Size = UDim2.new(0, 20, 0, 100),
                ZIndex = 21,
                Parent = colorpicker.Popup
            })
            AddCorner(colorpicker.HueSlider, 4)
            
            -- Hue Gradient
            local hueGradient = Create("UIGradient", {
                Color = ColorSequence.new({
                    ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 0, 0)),
                    ColorSequenceKeypoint.new(0.167, Color3.fromRGB(255, 255, 0)),
                    ColorSequenceKeypoint.new(0.333, Color3.fromRGB(0, 255, 0)),
                    ColorSequenceKeypoint.new(0.5, Color3.fromRGB(0, 255, 255)),
                    ColorSequenceKeypoint.new(0.667, Color3.fromRGB(0, 0, 255)),
                    ColorSequenceKeypoint.new(0.833, Color3.fromRGB(255, 0, 255)),
                    ColorSequenceKeypoint.new(1, Color3.fromRGB(255, 0, 0))
                }),
                Rotation = 90,
                Parent = colorpicker.HueSlider
            })
            
            colorpicker.HueCursor = Create("Frame", {
                Name = "HueCursor",
                BackgroundColor3 = Color3.new(1, 1, 1),
                Position = UDim2.new(0.5, -8, h, -2),
                Size = UDim2.new(0, 16, 0, 4),
                ZIndex = 22,
                Parent = colorpicker.HueSlider
            })
            AddCorner(colorpicker.HueCursor, 2)
            AddStroke(colorpicker.HueCursor, Color3.new(0, 0, 0), 1)
            
            -- Hex Input
            colorpicker.HexBox = Create("Frame", {
                Name = "HexBox",
                BackgroundColor3 = Library.Theme.ElementBackground,
                Position = UDim2.new(0, 10, 0, 120),
                Size = UDim2.new(0, 160, 0, 24),
                ZIndex = 21,
                Parent = colorpicker.Popup
            })
            AddCorner(colorpicker.HexBox, 4)
            
            colorpicker.HexInput = Create("TextBox", {
                Name = "HexInput",
                BackgroundTransparency = 1,
                Position = UDim2.new(0, 8, 0, 0),
                Size = UDim2.new(1, -16, 1, 0),
                Font = FONT,
                PlaceholderText = "#FFFFFF",
                Text = ColorToHex(default),
                TextColor3 = Library.Theme.Text,
                TextSize = 11,
                ZIndex = 22,
                ClearTextOnFocus = false,
                Parent = colorpicker.HexBox
            })
            
            function colorpicker:UpdateColor()
                colorpicker.Value = HSVToRGB(colorpicker.Hue, colorpicker.Sat, colorpicker.Val)
                colorpicker.Preview.BackgroundColor3 = colorpicker.Value
                colorpicker.SVPicker.BackgroundColor3 = HSVToRGB(colorpicker.Hue, 1, 1)
                colorpicker.HexInput.Text = ColorToHex(colorpicker.Value)
                callback(colorpicker.Value)
            end
            
            function colorpicker:Set(color)
                local h, s, v = RGBToHSV(color)
                colorpicker.Hue = h
                colorpicker.Sat = s
                colorpicker.Val = v
                colorpicker.SVCursor.Position = UDim2.new(s, -4, 1 - v, -4)
                colorpicker.HueCursor.Position = UDim2.new(0.5, -8, h, -2)
                colorpicker:UpdateColor()
            end
            
            -- Preview Click
            local previewBtn = Create("TextButton", {
                Name = "Button",
                BackgroundTransparency = 1,
                Size = UDim2.new(1, 0, 1, 0),
                Text = "",
                Parent = colorpicker.Preview
            })
            
            previewBtn.MouseButton1Click:Connect(function()
                colorpicker.Open = not colorpicker.Open
                colorpicker.Popup.Visible = colorpicker.Open
            end)
            
            -- SV Picker Input
            local svDragging = false
            
            colorpicker.SVPicker.InputBegan:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 then
                    svDragging = true
                end
            end)
            
            colorpicker.SVPicker.InputEnded:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 then
                    svDragging = false
                end
            end)
            
            -- Hue Slider Input
            local hueDragging = false
            
            colorpicker.HueSlider.InputBegan:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 then
                    hueDragging = true
                end
            end)
            
            colorpicker.HueSlider.InputEnded:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 then
                    hueDragging = false
                end
            end)
            
            UserInputService.InputChanged:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseMovement then
                    if svDragging then
                        local pos = colorpicker.SVPicker.AbsolutePosition
                        local size = colorpicker.SVPicker.AbsoluteSize
                        local x = math.clamp((input.Position.X - pos.X) / size.X, 0, 1)
                        local y = math.clamp((input.Position.Y - pos.Y) / size.Y, 0, 1)
                        
                        colorpicker.Sat = x
                        colorpicker.Val = 1 - y
                        colorpicker.SVCursor.Position = UDim2.new(x, -4, y, -4)
                        colorpicker:UpdateColor()
                    end
                    
                    if hueDragging then
                        local pos = colorpicker.HueSlider.AbsolutePosition
                        local size = colorpicker.HueSlider.AbsoluteSize
                        local y = math.clamp((input.Position.Y - pos.Y) / size.Y, 0, 1)
                        
                        colorpicker.Hue = y
                        colorpicker.HueCursor.Position = UDim2.new(0.5, -8, y, -2)
                        colorpicker:UpdateColor()
                    end
                end
            end)
            
            -- Hex Input
            colorpicker.HexInput.FocusLost:Connect(function()
                local success, color = pcall(HexToColor, colorpicker.HexInput.Text)
                if success then
                    colorpicker:Set(color)
                else
                    colorpicker.HexInput.Text = ColorToHex(colorpicker.Value)
                end
            end)
            
            if flag then
                Library.Flags[flag] = colorpicker
            end
            
            section.Elements[name] = colorpicker
            return colorpicker
        end
        
        -- Add Button
        function section:AddButton(options)
            options = options or {}
            local name = options.Name or "Button"
            local callback = options.Callback or function() end
            
            local button = {}
            
            button.Container = Create("Frame", {
                Name = name,
                BackgroundColor3 = Library.Theme.ElementBackground,
                Size = UDim2.new(1, 0, 0, 28),
                Parent = section.Content
            })
            AddCorner(button.Container, 4)
            AddStroke(button.Container, Library.Theme.Border, 1)
            
            button.Label = Create("TextLabel", {
                Name = "Label",
                BackgroundTransparency = 1,
                Size = UDim2.new(1, 0, 1, 0),
                Font = FONT,
                Text = name,
                TextColor3 = Library.Theme.Text,
                TextSize = 12,
                Parent = button.Container
            })
            
            local btn = Create("TextButton", {
                Name = "Button",
                BackgroundTransparency = 1,
                Size = UDim2.new(1, 0, 1, 0),
                Text = "",
                Parent = button.Container
            })
            
            btn.MouseEnter:Connect(function()
                Tween(button.Container, {BackgroundColor3 = Library.Theme.ElementBackgroundHover}, 0.2)
            end)
            
            btn.MouseLeave:Connect(function()
                Tween(button.Container, {BackgroundColor3 = Library.Theme.ElementBackground}, 0.2)
            end)
            
            btn.MouseButton1Click:Connect(function()
                Tween(button.Container, {BackgroundColor3 = Library.Theme.Accent}, 0.1)
                task.delay(0.1, function()
                    Tween(button.Container, {BackgroundColor3 = Library.Theme.ElementBackground}, 0.2)
                end)
                callback()
            end)
            
            section.Elements[name] = button
            return button
        end
        
        -- Add Button Row (Two Buttons)
        function section:AddButtonRow(options)
            options = options or {}
            local button1 = options.Button1 or {Name = "Button 1", Callback = function() end}
            local button2 = options.Button2 or {Name = "Button 2", Callback = function() end}
            
            local row = {}
            
            row.Container = Create("Frame", {
                Name = "ButtonRow",
                BackgroundTransparency = 1,
                Size = UDim2.new(1, 0, 0, 28),
                Parent = section.Content
            })
            
            -- Button 1
            row.Button1 = Create("Frame", {
                Name = button1.Name,
                BackgroundColor3 = Library.Theme.ElementBackground,
                Size = UDim2.new(0.5, -4, 1, 0),
                Parent = row.Container
            })
            AddCorner(row.Button1, 4)
            AddStroke(row.Button1, Library.Theme.Border, 1)
            
            Create("TextLabel", {
                BackgroundTransparency = 1,
                Size = UDim2.new(1, 0, 1, 0),
                Font = FONT,
                Text = button1.Name,
                TextColor3 = Library.Theme.Text,
                TextSize = 12,
                Parent = row.Button1
            })
            
            local btn1 = Create("TextButton", {
                BackgroundTransparency = 1,
                Size = UDim2.new(1, 0, 1, 0),
                Text = "",
                Parent = row.Button1
            })
            
            btn1.MouseEnter:Connect(function()
                Tween(row.Button1, {BackgroundColor3 = Library.Theme.ElementBackgroundHover}, 0.2)
            end)
            
            btn1.MouseLeave:Connect(function()
                Tween(row.Button1, {BackgroundColor3 = Library.Theme.ElementBackground}, 0.2)
            end)
            
            btn1.MouseButton1Click:Connect(function()
                Tween(row.Button1, {BackgroundColor3 = Library.Theme.Accent}, 0.1)
                task.delay(0.1, function()
                    Tween(row.Button1, {BackgroundColor3 = Library.Theme.ElementBackground}, 0.2)
                end)
                button1.Callback()
            end)
            
            -- Button 2
            row.Button2 = Create("Frame", {
                Name = button2.Name,
                BackgroundColor3 = Library.Theme.ElementBackground,
                Position = UDim2.new(0.5, 4, 0, 0),
                Size = UDim2.new(0.5, -4, 1, 0),
                Parent = row.Container
            })
            AddCorner(row.Button2, 4)
            AddStroke(row.Button2, Library.Theme.Border, 1)
            
            Create("TextLabel", {
                BackgroundTransparency = 1,
                Size = UDim2.new(1, 0, 1, 0),
                Font = FONT,
                Text = button2.Name,
                TextColor3 = Library.Theme.Text,
                TextSize = 12,
                Parent = row.Button2
            })
            
            local btn2 = Create("TextButton", {
                BackgroundTransparency = 1,
                Size = UDim2.new(1, 0, 1, 0),
                Text = "",
                Parent = row.Button2
            })
            
            btn2.MouseEnter:Connect(function()
                Tween(row.Button2, {BackgroundColor3 = Library.Theme.ElementBackgroundHover}, 0.2)
            end)
            
            btn2.MouseLeave:Connect(function()
                Tween(row.Button2, {BackgroundColor3 = Library.Theme.ElementBackground}, 0.2)
            end)
            
            btn2.MouseButton1Click:Connect(function()
                Tween(row.Button2, {BackgroundColor3 = Library.Theme.Accent}, 0.1)
                task.delay(0.1, function()
                    Tween(row.Button2, {BackgroundColor3 = Library.Theme.ElementBackground}, 0.2)
                end)
                button2.Callback()
            end)
            
            section.Elements["ButtonRow"] = row
            return row
        end
        
        -- Add Label
        function section:AddLabel(options)
            options = options or {}
            local text = options.Text or "Label"
            
            local label = {}
            
            label.Container = Create("Frame", {
                Name = "Label",
                BackgroundTransparency = 1,
                Size = UDim2.new(1, 0, 0, 20),
                Parent = section.Content
            })
            
            label.Text = Create("TextLabel", {
                Name = "Text",
                BackgroundTransparency = 1,
                Size = UDim2.new(1, 0, 1, 0),
                Font = FONT,
                Text = text,
                TextColor3 = Library.Theme.TextDark,
                TextSize = 12,
                TextXAlignment = Enum.TextXAlignment.Left,
                Parent = label.Container
            })
            
            function label:Set(newText)
                label.Text.Text = newText
            end
            
            section.Elements["Label"] = label
            return label
        end
        
        -- Add Status Label
        function section:AddStatusLabel(options)
            options = options or {}
            local name = options.Name or "Status"
            local value = options.Value or "Active"
            local color = options.Color or Library.Theme.AccentGreen
            
            local status = {}
            
            status.Container = Create("Frame", {
                Name = name,
                BackgroundTransparency = 1,
                Size = UDim2.new(1, 0, 0, 20),
                Parent = section.Content
            })
            
            status.Label = Create("TextLabel", {
                Name = "Label",
                BackgroundTransparency = 1,
                Size = UDim2.new(0.5, 0, 1, 0),
                Font = FONT,
                Text = name,
                TextColor3 = Library.Theme.Text,
                TextSize = 12,
                TextXAlignment = Enum.TextXAlignment.Left,
                Parent = status.Container
            })
            
            status.Value = Create("TextLabel", {
                Name = "Value",
                BackgroundTransparency = 1,
                Position = UDim2.new(0.5, 0, 0, 0),
                Size = UDim2.new(0.5, 0, 1, 0),
                Font = FONT,
                Text = value,
                TextColor3 = color,
                TextSize = 12,
                TextXAlignment = Enum.TextXAlignment.Right,
                Parent = status.Container
            })
            
            function status:Set(newValue, newColor)
                status.Value.Text = newValue
                if newColor then
                    status.Value.TextColor3 = newColor
                end
            end
            
            section.Elements[name] = status
            return status
        end
        
        -- Add Graph
        function section:AddGraph(options)
            options = options or {}
            local name = options.Name or "Graph"
            local width = options.Width or 200
            local height = options.Height or 80
            
            local graph = {}
            graph.Points = {}
            
            graph.Container = Create("Frame", {
                Name = name,
                BackgroundTransparency = 1,
                Size = UDim2.new(1, 0, 0, height + 30),
                Parent = section.Content
            })
            
            graph.Label = Create("TextLabel", {
                Name = "Label",
                BackgroundTransparency = 1,
                Size = UDim2.new(1, 0, 0, 16),
                Font = FONT,
                Text = name,
                TextColor3 = Library.Theme.Text,
                TextSize = 12,
                TextXAlignment = Enum.TextXAlignment.Left,
                Parent = graph.Container
            })
            
            graph.GraphFrame = Create("Frame", {
                Name = "GraphFrame",
                BackgroundColor3 = Library.Theme.ElementBackground,
                Position = UDim2.new(0, 0, 0, 20),
                Size = UDim2.new(1, 0, 0, height),
                Parent = graph.Container
            })
            AddCorner(graph.GraphFrame, 4)
            AddStroke(graph.GraphFrame, Library.Theme.Border, 1)
            
            -- Axis Lines
            Create("Frame", {
                Name = "XAxis",
                BackgroundColor3 = Library.Theme.GraphAxis,
                Position = UDim2.new(0, 0, 1, -1),
                Size = UDim2.new(1, 0, 0, 1),
                Parent = graph.GraphFrame
            })
            
            Create("Frame", {
                Name = "YAxis",
                BackgroundColor3 = Library.Theme.GraphAxis,
                Position = UDim2.new(0, 0, 0, 0),
                Size = UDim2.new(0, 1, 1, 0),
                Parent = graph.GraphFrame
            })
            
            -- Graph Line Container
            graph.LineContainer = Create("Frame", {
                Name = "Lines",
                BackgroundTransparency = 1,
                Size = UDim2.new(1, 0, 1, 0),
                ClipsDescendants = true,
                Parent = graph.GraphFrame
            })
            
            -- Coordinate Display
            graph.CoordLabel = Create("TextLabel", {
                Name = "Coords",
                BackgroundTransparency = 1,
                Position = UDim2.new(1, -60, 0, 0),
                Size = UDim2.new(0, 60, 0, 16),
                Font = FONT,
                Text = "X: 0 Y: 0",
                TextColor3 = Library.Theme.TextDark,
                TextSize = 10,
                TextXAlignment = Enum.TextXAlignment.Right,
                Parent = graph.Container
            })
            
            function graph:SetPoints(points)
                graph.Points = points
                
                -- Clear existing lines
                for _, child in ipairs(graph.LineContainer:GetChildren()) do
                    child:Destroy()
                end
                
                if #points < 2 then return end
                
                local maxY = 0
                for _, p in ipairs(points) do
                    if p.Y > maxY then maxY = p.Y end
                end
                if maxY == 0 then maxY = 1 end
                
                for i = 1, #points - 1 do
                    local p1 = points[i]
                    local p2 = points[i + 1]
                    
                    local x1 = (i - 1) / (#points - 1)
                    local y1 = 1 - (p1.Y / maxY)
                    local x2 = i / (#points - 1)
                    local y2 = 1 - (p2.Y / maxY)
                    
                    local dx = x2 - x1
                    local dy = y2 - y1
                    local length = math.sqrt(dx * dx + dy * dy)
                    local angle = math.atan2(dy, dx)
                    
                    local line = Create("Frame", {
                        Name = "Line" .. i,
                        BackgroundColor3 = Library.Theme.GraphLine,
                        Position = UDim2.new(x1, 0, y1, 0),
                        Size = UDim2.new(length, 0, 0, 2),
                        Rotation = math.deg(angle),
                        AnchorPoint = Vector2.new(0, 0.5),
                        Parent = graph.LineContainer
                    })
                end
            end
            
            -- Generate sample sine wave
            local samplePoints = {}
            for i = 0, 20 do
                table.insert(samplePoints, {
                    X = i,
                    Y = math.sin(i / 3) * 0.5 + 0.5
                })
            end
            graph:SetPoints(samplePoints)
            
            section.Elements[name] = graph
            return graph
        end
        
        return section
    end
    
    table.insert(self.Windows, window)
    return window
end

-- Floating Colorpicker Panel
function Library:CreateColorpickerPanel(options)
    options = options or {}
    local position = options.Position or UDim2.new(0, 20, 0.5, -200)
    local default = options.Default or Color3.fromRGB(146, 255, 155)
    local callback = options.Callback or function() end
    
    local panel = {}
    panel.Value = default
    panel.SyncEnabled = false
    panel.RainbowEnabled = false
    
    local h, s, v = RGBToHSV(default)
    panel.Hue = h
    panel.Sat = s
    panel.Val = v
    panel.Alpha = 1
    
    panel.Container = Create("Frame", {
        Name = "ColorpickerPanel",
        BackgroundColor3 = Library.Theme.Background,
        Position = position,
        Size = UDim2.new(0, 220, 0, 340),
        Parent = self.ScreenGui
    })
    AddCorner(panel.Container, 8)
    AddShadow(panel.Container)
    AddStroke(panel.Container, Library.Theme.Border, 1)
    
    -- Header
    panel.Header = Create("Frame", {
        Name = "Header",
        BackgroundColor3 = Library.Theme.SecondaryBackground,
        Size = UDim2.new(1, 0, 0, 32),
        Parent = panel.Container
    })
    AddCorner(panel.Header, 8)
    
    Create("Frame", {
        BackgroundColor3 = Library.Theme.SecondaryBackground,
        Position = UDim2.new(0, 0, 1, -8),
        Size = UDim2.new(1, 0, 0, 8),
        BorderSizePixel = 0,
        Parent = panel.Header
    })
    
    panel.Title = Create("TextLabel", {
        Name = "Title",
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 12, 0, 0),
        Size = UDim2.new(1, -24, 1, 0),
        Font = FONT_SEMIBOLD,
        Text = "Colorpicker",
        TextColor3 = Library.Theme.Text,
        TextSize = 13,
        TextXAlignment = Enum.TextXAlignment.Left,
        Parent = panel.Header
    })
    
    -- Main Color Area (SV Picker)
    panel.SVPicker = Create("ImageLabel", {
        Name = "SVPicker",
        BackgroundColor3 = HSVToRGB(h, 1, 1),
        Position = UDim2.new(0, 12, 0, 44),
        Size = UDim2.new(0, 160, 0, 120),
        Image = "rbxassetid://4155801252",
        Parent = panel.Container
    })
    AddCorner(panel.SVPicker, 4)
    
    panel.SVCursor = Create("Frame", {
        Name = "Cursor",
        BackgroundColor3 = Color3.new(1, 1, 1),
        Position = UDim2.new(s, -5, 1 - v, -5),
        Size = UDim2.new(0, 10, 0, 10),
        ZIndex = 2,
        Parent = panel.SVPicker
    })
    AddCorner(panel.SVCursor, 5)
    AddStroke(panel.SVCursor, Color3.new(0, 0, 0), 2)
    
    -- Hue Slider (Vertical)
    panel.HueSlider = Create("Frame", {
        Name = "HueSlider",
        BackgroundColor3 = Color3.new(1, 1, 1),
        Position = UDim2.new(0, 184, 0, 44),
        Size = UDim2.new(0, 24, 0, 120),
        Parent = panel.Container
    })
    AddCorner(panel.HueSlider, 4)
    
    Create("UIGradient", {
        Color = ColorSequence.new({
            ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 0, 0)),
            ColorSequenceKeypoint.new(0.167, Color3.fromRGB(255, 255, 0)),
            ColorSequenceKeypoint.new(0.333, Color3.fromRGB(0, 255, 0)),
            ColorSequenceKeypoint.new(0.5, Color3.fromRGB(0, 255, 255)),
            ColorSequenceKeypoint.new(0.667, Color3.fromRGB(0, 0, 255)),
            ColorSequenceKeypoint.new(0.833, Color3.fromRGB(255, 0, 255)),
            ColorSequenceKeypoint.new(1, Color3.fromRGB(255, 0, 0))
        }),
        Rotation = 90,
        Parent = panel.HueSlider
    })
    
    panel.HueCursor = Create("Frame", {
        Name = "HueCursor",
        BackgroundColor3 = Color3.new(1, 1, 1),
        Position = UDim2.new(0, -2, h, -3),
        Size = UDim2.new(1, 4, 0, 6),
        ZIndex = 2,
        Parent = panel.HueSlider
    })
    AddCorner(panel.HueCursor, 3)
    AddStroke(panel.HueCursor, Color3.new(0, 0, 0), 1)
    
    -- Alpha/Brightness Slider (Horizontal)
    panel.AlphaSlider = Create("Frame", {
        Name = "AlphaSlider",
        BackgroundColor3 = Color3.new(1, 1, 1),
        Position = UDim2.new(0, 12, 0, 176),
        Size = UDim2.new(0, 196, 0, 16),
        Parent = panel.Container
    })
    AddCorner(panel.AlphaSlider, 4)
    
    panel.AlphaGradient = Create("UIGradient", {
        Color = ColorSequence.new({
            ColorSequenceKeypoint.new(0, Color3.new(0, 0, 0)),
            ColorSequenceKeypoint.new(1, panel.Value)
        }),
        Parent = panel.AlphaSlider
    })
    
    panel.AlphaCursor = Create("Frame", {
        Name = "AlphaCursor",
        BackgroundColor3 = Color3.new(1, 1, 1),
        Position = UDim2.new(panel.Alpha, -3, 0, -2),
        Size = UDim2.new(0, 6, 1, 4),
        ZIndex = 2,
        Parent = panel.AlphaSlider
    })
    AddCorner(panel.AlphaCursor, 3)
    AddStroke(panel.AlphaCursor, Color3.new(0, 0, 0), 1)
    
    -- Sync Colorpickers Toggle
    panel.SyncContainer = Create("Frame", {
        Name = "SyncContainer",
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 12, 0, 202),
        Size = UDim2.new(0, 196, 0, 22),
        Parent = panel.Container
    })
    
    panel.SyncBox = Create("Frame", {
        Name = "SyncBox",
        BackgroundColor3 = Library.Theme.ToggleOff,
        Position = UDim2.new(0, 0, 0.5, -8),
        Size = UDim2.new(0, 32, 0, 16),
        Parent = panel.SyncContainer
    })
    AddCorner(panel.SyncBox, 8)
    
    panel.SyncCircle = Create("Frame", {
        Name = "Circle",
        BackgroundColor3 = Library.Theme.Text,
        Position = UDim2.new(0, 2, 0.5, -6),
        Size = UDim2.new(0, 12, 0, 12),
        Parent = panel.SyncBox
    })
    AddCorner(panel.SyncCircle, 6)
    
    panel.SyncLabel = Create("TextLabel", {
        Name = "Label",
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 42, 0, 0),
        Size = UDim2.new(1, -42, 1, 0),
        Font = FONT,
        Text = "Sync colorpickers",
        TextColor3 = Library.Theme.Text,
        TextSize = 11,
        TextXAlignment = Enum.TextXAlignment.Left,
        Parent = panel.SyncContainer
    })
    
    local syncBtn = Create("TextButton", {
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 1, 0),
        Text = "",
        Parent = panel.SyncContainer
    })
    
    syncBtn.MouseButton1Click:Connect(function()
        panel.SyncEnabled = not panel.SyncEnabled
        Tween(panel.SyncBox, {BackgroundColor3 = panel.SyncEnabled and Library.Theme.ToggleOn or Library.Theme.ToggleOff}, 0.2)
        Tween(panel.SyncCircle, {Position = panel.SyncEnabled and UDim2.new(1, -14, 0.5, -6) or UDim2.new(0, 2, 0.5, -6)}, 0.2)
    end)
    
    -- Rainbow Toggle
    panel.RainbowContainer = Create("Frame", {
        Name = "RainbowContainer",
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 12, 0, 228),
        Size = UDim2.new(0, 196, 0, 22),
        Parent = panel.Container
    })
    
    panel.RainbowBox = Create("Frame", {
        Name = "RainbowBox",
        BackgroundColor3 = Library.Theme.ToggleOff,
        Position = UDim2.new(0, 0, 0.5, -8),
        Size = UDim2.new(0, 32, 0, 16),
        Parent = panel.RainbowContainer
    })
    AddCorner(panel.RainbowBox, 8)
    
    panel.RainbowCircle = Create("Frame", {
        Name = "Circle",
        BackgroundColor3 = Library.Theme.Text,
        Position = UDim2.new(0, 2, 0.5, -6),
        Size = UDim2.new(0, 12, 0, 12),
        Parent = panel.RainbowBox
    })
    AddCorner(panel.RainbowCircle, 6)
    
    panel.RainbowLabel = Create("TextLabel", {
        Name = "Label",
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 42, 0, 0),
        Size = UDim2.new(1, -42, 1, 0),
        Font = FONT,
        Text = "Rainbow",
        TextColor3 = Library.Theme.Text,
        TextSize = 11,
        TextXAlignment = Enum.TextXAlignment.Left,
        Parent = panel.RainbowContainer
    })
    
    local rainbowBtn = Create("TextButton", {
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 1, 0),
        Text = "",
        Parent = panel.RainbowContainer
    })
    
    rainbowBtn.MouseButton1Click:Connect(function()
        panel.RainbowEnabled = not panel.RainbowEnabled
        Tween(panel.RainbowBox, {BackgroundColor3 = panel.RainbowEnabled and Library.Theme.ToggleOn or Library.Theme.ToggleOff}, 0.2)
        Tween(panel.RainbowCircle, {Position = panel.RainbowEnabled and UDim2.new(1, -14, 0.5, -6) or UDim2.new(0, 2, 0.5, -6)}, 0.2)
    end)
    
    -- Rainbow Update Loop
    task.spawn(function()
        while true do
            if panel.RainbowEnabled then
                panel.Hue = (panel.Hue + 0.005) % 1
                panel.HueCursor.Position = UDim2.new(0, -2, panel.Hue, -3)
                panel:UpdateColor()
            end
            task.wait(0.05)
        end
    end)
    
    -- Hex Input
    panel.HexContainer = Create("Frame", {
        Name = "HexContainer",
        BackgroundColor3 = Library.Theme.ElementBackground,
        Position = UDim2.new(0, 12, 0, 260),
        Size = UDim2.new(0, 94, 0, 28),
        Parent = panel.Container
    })
    AddCorner(panel.HexContainer, 4)
    AddStroke(panel.HexContainer, Library.Theme.Border, 1)
    
    panel.HexInput = Create("TextBox", {
        Name = "HexInput",
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 8, 0, 0),
        Size = UDim2.new(1, -16, 1, 0),
        Font = FONT,
        PlaceholderText = "#FFFFFF",
        Text = ColorToHex(default),
        TextColor3 = Library.Theme.Text,
        TextSize = 12,
        ClearTextOnFocus = false,
        Parent = panel.HexContainer
    })
    
    -- RGB Input
    panel.RGBContainer = Create("Frame", {
        Name = "RGBContainer",
        BackgroundColor3 = Library.Theme.ElementBackground,
        Position = UDim2.new(0, 114, 0, 260),
        Size = UDim2.new(0, 94, 0, 28),
        Parent = panel.Container
    })
    AddCorner(panel.RGBContainer, 4)
    AddStroke(panel.RGBContainer, Library.Theme.Border, 1)
    
    panel.RGBInput = Create("TextBox", {
        Name = "RGBInput",
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 8, 0, 0),
        Size = UDim2.new(1, -16, 1, 0),
        Font = FONT,
        PlaceholderText = "255, 255, 255",
        Text = string.format("%d, %d, %d", 
            math.floor(default.R * 255), 
            math.floor(default.G * 255), 
            math.floor(default.B * 255)
        ),
        TextColor3 = Library.Theme.Text,
        TextSize = 12,
        ClearTextOnFocus = false,
        Parent = panel.RGBContainer
    })
    
    -- Update Color Function
    function panel:UpdateColor()
        panel.Value = HSVToRGB(panel.Hue, panel.Sat, panel.Val)
        panel.SVPicker.BackgroundColor3 = HSVToRGB(panel.Hue, 1, 1)
        panel.HexInput.Text = ColorToHex(panel.Value)
        panel.RGBInput.Text = string.format("%d, %d, %d", 
            math.floor(panel.Value.R * 255), 
            math.floor(panel.Value.G * 255), 
            math.floor(panel.Value.B * 255)
        )
        panel.AlphaGradient.Color = ColorSequence.new({
            ColorSequenceKeypoint.new(0, Color3.new(0, 0, 0)),
            ColorSequenceKeypoint.new(1, panel.Value)
        })
        callback(panel.Value, panel.Alpha)
    end
    
    function panel:Set(color)
        local h, s, v = RGBToHSV(color)
        panel.Hue = h
        panel.Sat = s
        panel.Val = v
        panel.SVCursor.Position = UDim2.new(s, -5, 1 - v, -5)
        panel.HueCursor.Position = UDim2.new(0, -2, h, -3)
        panel:UpdateColor()
    end
    
    -- SV Picker Input Handling
    local svDragging = false
    
    panel.SVPicker.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            svDragging = true
        end
    end)
    
    panel.SVPicker.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            svDragging = false
        end
    end)
    
    -- Hue Slider Input Handling
    local hueDragging = false
    
    panel.HueSlider.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            hueDragging = true
        end
    end)
    
    panel.HueSlider.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            hueDragging = false
        end
    end)
    
    -- Alpha Slider Input Handling
    local alphaDragging = false
    
    panel.AlphaSlider.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            alphaDragging = true
        end
    end)
    
    panel.AlphaSlider.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            alphaDragging = false
        end
    end)
    
    -- Global Input Changed
    UserInputService.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then
            if svDragging then
                local pos = panel.SVPicker.AbsolutePosition
                local size = panel.SVPicker.AbsoluteSize
                local x = math.clamp((input.Position.X - pos.X) / size.X, 0, 1)
                local y = math.clamp((input.Position.Y - pos.Y) / size.Y, 0, 1)
                
                panel.Sat = x
                panel.Val = 1 - y
                panel.SVCursor.Position = UDim2.new(x, -5, y, -5)
                panel:UpdateColor()
            end
            
            if hueDragging then
                local pos = panel.HueSlider.AbsolutePosition
                local size = panel.HueSlider.AbsoluteSize
                local y = math.clamp((input.Position.Y - pos.Y) / size.Y, 0, 1)
                
                panel.Hue = y
                panel.HueCursor.Position = UDim2.new(0, -2, y, -3)
                panel:UpdateColor()
            end
            
            if alphaDragging then
                local pos = panel.AlphaSlider.AbsolutePosition
                local size = panel.AlphaSlider.AbsoluteSize
                local x = math.clamp((input.Position.X - pos.X) / size.X, 0, 1)
                
                panel.Alpha = x
                panel.AlphaCursor.Position = UDim2.new(x, -3, 0, -2)
                panel:UpdateColor()
            end
        end
    end)
    
    -- Hex Input Handler
    panel.HexInput.FocusLost:Connect(function()
        local success, color = pcall(HexToColor, panel.HexInput.Text)
        if success then
            panel:Set(color)
        else
            panel.HexInput.Text = ColorToHex(panel.Value)
        end
    end)
    
    -- RGB Input Handler
    panel.RGBInput.FocusLost:Connect(function()
        local text = panel.RGBInput.Text
        local r, g, b = text:match("(%d+)%s*,%s*(%d+)%s*,%s*(%d+)")
        if r and g and b then
            r = math.clamp(tonumber(r), 0, 255)
            g = math.clamp(tonumber(g), 0, 255)
            b = math.clamp(tonumber(b), 0, 255)
            panel:Set(Color3.fromRGB(r, g, b))
        else
            panel.RGBInput.Text = string.format("%d, %d, %d", 
                math.floor(panel.Value.R * 255), 
                math.floor(panel.Value.G * 255), 
                math.floor(panel.Value.B * 255)
            )
        end
    end)
    
    -- Dragging Panel
    local dragging, dragStart, startPos
    
    panel.Header.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = panel.Container.Position
        end
    end)
    
    panel.Header.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = false
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            local delta = input.Position - dragStart
            panel.Container.Position = UDim2.new(
                startPos.X.Scale, startPos.X.Offset + delta.X,
                startPos.Y.Scale, startPos.Y.Offset + delta.Y
            )
        end
    end)
    
    return panel
end

-- Toggle Box Panel (Hold/Always)
function Library:CreateToggleBox(options)
    options = options or {}
    local position = options.Position or UDim2.new(0, 20, 0.5, 120)
    local title = options.Title or "Toggle"
    local callback = options.Callback or function() end
    
    local toggleBox = {}
    toggleBox.Mode = "Hold" -- Hold or Always
    
    toggleBox.Container = Create("Frame", {
        Name = "ToggleBox",
        BackgroundColor3 = Library.Theme.Background,
        Position = position,
        Size = UDim2.new(0, 180, 0, 70),
        Parent = self.ScreenGui
    })
    AddCorner(toggleBox.Container, 8)
    AddShadow(toggleBox.Container)
    AddStroke(toggleBox.Container, Library.Theme.Border, 1)
    
    -- Header
    toggleBox.Header = Create("Frame", {
        Name = "Header",
        BackgroundColor3 = Library.Theme.SecondaryBackground,
        Size = UDim2.new(1, 0, 0, 28),
        Parent = toggleBox.Container
    })
    AddCorner(toggleBox.Header, 8)
    
    Create("Frame", {
        BackgroundColor3 = Library.Theme.SecondaryBackground,
        Position = UDim2.new(0, 0, 1, -8),
        Size = UDim2.new(1, 0, 0, 8),
        BorderSizePixel = 0,
        Parent = toggleBox.Header
    })
    
    toggleBox.Title = Create("TextLabel", {
        Name = "Title",
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 12, 0, 0),
        Size = UDim2.new(1, -24, 1, 0),
        Font = FONT_SEMIBOLD,
        Text = title,
        TextColor3 = Library.Theme.Text,
        TextSize = 12,
        TextXAlignment = Enum.TextXAlignment.Left,
        Parent = toggleBox.Header
    })
    
    -- Options Container
    toggleBox.OptionsContainer = Create("Frame", {
        Name = "Options",
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 12, 0, 36),
        Size = UDim2.new(1, -24, 0, 26),
        Parent = toggleBox.Container
    })
    
    -- Hold Button
    toggleBox.HoldBtn = Create("Frame", {
        Name = "Hold",
        BackgroundColor3 = Library.Theme.Accent,
        Position = UDim2.new(0, 0, 0, 0),
        Size = UDim2.new(0.5, -4, 1, 0),
        Parent = toggleBox.OptionsContainer
    })
    AddCorner(toggleBox.HoldBtn, 4)
    
    toggleBox.HoldLabel = Create("TextLabel", {
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 1, 0),
        Font = FONT,
        Text = "Hold",
        TextColor3 = Library.Theme.Text,
        TextSize = 11,
        Parent = toggleBox.HoldBtn
    })
    
    local holdButton = Create("TextButton", {
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 1, 0),
        Text = "",
        Parent = toggleBox.HoldBtn
    })
    
    -- Always Button
    toggleBox.AlwaysBtn = Create("Frame", {
        Name = "Always",
        BackgroundColor3 = Library.Theme.ElementBackground,
        Position = UDim2.new(0.5, 4, 0, 0),
        Size = UDim2.new(0.5, -4, 1, 0),
        Parent = toggleBox.OptionsContainer
    })
    AddCorner(toggleBox.AlwaysBtn, 4)
    
    toggleBox.AlwaysLabel = Create("TextLabel", {
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 1, 0),
        Font = FONT,
        Text = "Always",
        TextColor3 = Library.Theme.Text,
        TextSize = 11,
        Parent = toggleBox.AlwaysBtn
    })
    
    local alwaysButton = Create("TextButton", {
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 1, 0),
        Text = "",
        Parent = toggleBox.AlwaysBtn
    })
    
    function toggleBox:SetMode(mode)
        toggleBox.Mode = mode
        if mode == "Hold" then
            Tween(toggleBox.HoldBtn, {BackgroundColor3 = Library.Theme.Accent}, 0.2)
            Tween(toggleBox.AlwaysBtn, {BackgroundColor3 = Library.Theme.ElementBackground}, 0.2)
        else
            Tween(toggleBox.HoldBtn, {BackgroundColor3 = Library.Theme.ElementBackground}, 0.2)
            Tween(toggleBox.AlwaysBtn, {BackgroundColor3 = Library.Theme.Accent}, 0.2)
        end
        callback(mode)
    end
    
    holdButton.MouseButton1Click:Connect(function()
        toggleBox:SetMode("Hold")
    end)
    
    alwaysButton.MouseButton1Click:Connect(function()
        toggleBox:SetMode("Always")
    end)
    
    -- Dragging
    local dragging, dragStart, startPos
    
    toggleBox.Header.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = toggleBox.Container.Position
        end
    end)
    
    toggleBox.Header.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = false
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            local delta = input.Position - dragStart
            toggleBox.Container.Position = UDim2.new(
                startPos.X.Scale, startPos.X.Offset + delta.X,
                startPos.Y.Scale, startPos.Y.Offset + delta.Y
            )
        end
    end)
    
    return toggleBox
end

-- Tooltip System
function Library:CreateTooltip(options)
    options = options or {}
    local text = options.Text or "Hello, this is a tooltip"
    local position = options.Position or UDim2.new(0, 200, 0.5, 150)
    
    local tooltip = {}
    
    tooltip.Container = Create("Frame", {
        Name = "Tooltip",
        BackgroundColor3 = Library.Theme.TertiaryBackground,
        Position = position,
        Size = UDim2.new(0, 0, 0, 28),
        AutomaticSize = Enum.AutomaticSize.X,
        Parent = self.TooltipContainer
    })
    AddCorner(tooltip.Container, 6)
    AddStroke(tooltip.Container, Library.Theme.Border, 1)
    
    tooltip.Text = Create("TextLabel", {
        Name = "Text",
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 12, 0, 0),
        Size = UDim2.new(0, 0, 1, 0),
        AutomaticSize = Enum.AutomaticSize.X,
        Font = FONT,
        Text = text,
        TextColor3 = Library.Theme.TextDark,
        TextSize = 12,
        Parent = tooltip.Container
    })
    
    Create("UIPadding", {
        PaddingRight = UDim.new(0, 12),
        Parent = tooltip.Container
    })
    
    function tooltip:SetText(newText)
        tooltip.Text.Text = newText
    end
    
    function tooltip:Show()
        tooltip.Container.Visible = true
        Tween(tooltip.Container, {BackgroundTransparency = 0}, 0.2)
    end
    
    function tooltip:Hide()
        Tween(tooltip.Container, {BackgroundTransparency = 1}, 0.2)
        task.delay(0.2, function()
            tooltip.Container.Visible = false
        end)
    end
    
    return tooltip
end

-- Notification System
function Library:Notify(options)
    options = options or {}
    local title = options.Title or "Notification title"
    local description = options.Description or "This is a notification description."
    local duration = options.Duration or 5
    local notifType = options.Type or "Normal" -- Normal, Infinite, YesNo
    local yesCallback = options.YesCallback or function() end
    local noCallback = options.NoCallback or function() end
    
    local notification = {}
    
    local height = 70
    if notifType == "YesNo" then
        height = 100
    elseif notifType == "Infinite" then
        height = 90
    end
    
    notification.Container = Create("Frame", {
        Name = "Notification",
        BackgroundColor3 = Library.Theme.Notification,
        Size = UDim2.new(1, 0, 0, height),
        ClipsDescendants = true,
        Parent = self.NotificationContainer
    })
    AddCorner(notification.Container, 6)
    AddShadow(notification.Container)
    AddStroke(notification.Container, Library.Theme.Border, 1)
    
    -- Slide In Animation
    notification.Container.Position = UDim2.new(1, 50, 0, 0)
    Tween(notification.Container, {Position = UDim2.new(0, 0, 0, 0)}, 0.3, Enum.EasingStyle.Quart, Enum.EasingDirection.Out)
    
    -- Progress Bar (for timed notifications)
    if notifType == "Normal" then
        notification.ProgressBar = Create("Frame", {
            Name = "Progress",
            BackgroundColor3 = Library.Theme.Accent,
            Position = UDim2.new(0, 0, 1, -3),
            Size = UDim2.new(1, 0, 0, 3),
            Parent = notification.Container
        })
        AddCorner(notification.ProgressBar, 2)
    end
    
    -- Title
    notification.Title = Create("TextLabel", {
        Name = "Title",
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 12, 0, 8),
        Size = UDim2.new(1, -24, 0, 18),
        Font = FONT_SEMIBOLD,
        Text = title,
        TextColor3 = Library.Theme.Text,
        TextSize = 13,
        TextXAlignment = Enum.TextXAlignment.Left,
        Parent = notification.Container
    })
    
    -- Description
    notification.Description = Create("TextLabel", {
        Name = "Description",
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 12, 0, 28),
        Size = UDim2.new(1, -24, 0, 32),
        Font = FONT,
        Text = description,
        TextColor3 = Library.Theme.TextDark,
        TextSize = 11,
        TextXAlignment = Enum.TextXAlignment.Left,
        TextYAlignment = Enum.TextYAlignment.Top,
        TextWrapped = true,
        Parent = notification.Container
    })
    
    function notification:Dismiss()
        Tween(notification.Container, {Position = UDim2.new(1, 50, 0, 0)}, 0.3, Enum.EasingStyle.Quart, Enum.EasingDirection.In)
        task.delay(0.3, function()
            notification.Container:Destroy()
        end)
    end
    
    if notifType == "Normal" then
        -- Animate progress bar and auto-dismiss
        Tween(notification.ProgressBar, {Size = UDim2.new(0, 0, 0, 3)}, duration, Enum.EasingStyle.Linear)
        task.delay(duration, function()
            notification:Dismiss()
        end)
        
    elseif notifType == "Infinite" then
        -- Dismiss Button
        notification.DismissBtn = Create("Frame", {
            Name = "DismissBtn",
            BackgroundColor3 = Library.Theme.ElementBackground,
            Position = UDim2.new(0, 12, 1, -34),
            Size = UDim2.new(1, -24, 0, 26),
            Parent = notification.Container
        })
        AddCorner(notification.DismissBtn, 4)
        
        Create("TextLabel", {
            BackgroundTransparency = 1,
            Size = UDim2.new(1, 0, 1, 0),
            Font = FONT,
            Text = "Dismiss",
            TextColor3 = Library.Theme.Text,
            TextSize = 11,
            Parent = notification.DismissBtn
        })
        
        local dismissButton = Create("TextButton", {
            BackgroundTransparency = 1,
            Size = UDim2.new(1, 0, 1, 0),
            Text = "",
            Parent = notification.DismissBtn
        })
        
        dismissButton.MouseEnter:Connect(function()
            Tween(notification.DismissBtn, {BackgroundColor3 = Library.Theme.ElementBackgroundHover}, 0.2)
        end)
        
        dismissButton.MouseLeave:Connect(function()
            Tween(notification.DismissBtn, {BackgroundColor3 = Library.Theme.ElementBackground}, 0.2)
        end)
        
        dismissButton.MouseButton1Click:Connect(function()
            notification:Dismiss()
        end)
        
    elseif notifType == "YesNo" then
        -- Yes Button
        notification.YesBtn = Create("Frame", {
            Name = "YesBtn",
            BackgroundColor3 = Library.Theme.AccentGreen,
            Position = UDim2.new(0, 12, 1, -34),
            Size = UDim2.new(0.5, -16, 0, 26),
            Parent = notification.Container
        })
        AddCorner(notification.YesBtn, 4)
        
        Create("TextLabel", {
            BackgroundTransparency = 1,
            Size = UDim2.new(1, 0, 1, 0),
            Font = FONT,
            Text = "Yes",
            TextColor3 = Library.Theme.Background,
            TextSize = 11,
            Parent = notification.YesBtn
        })
        
        local yesButton = Create("TextButton", {
            BackgroundTransparency = 1,
            Size = UDim2.new(1, 0, 1, 0),
            Text = "",
            Parent = notification.YesBtn
        })
        
        yesButton.MouseButton1Click:Connect(function()
            yesCallback()
            notification:Dismiss()
        end)
        
        -- No Button
        notification.NoBtn = Create("Frame", {
            Name = "NoBtn",
            BackgroundColor3 = Library.Theme.AccentRed,
            Position = UDim2.new(0.5, 4, 1, -34),
            Size = UDim2.new(0.5, -16, 0, 26),
            Parent = notification.Container
        })
        AddCorner(notification.NoBtn, 4)
        
        Create("TextLabel", {
            BackgroundTransparency = 1,
            Size = UDim2.new(1, 0, 1, 0),
            Font = FONT,
            Text = "No",
            TextColor3 = Library.Theme.Text,
            TextSize = 11,
            Parent = notification.NoBtn
        })
        
        local noButton = Create("TextButton", {
            BackgroundTransparency = 1,
            Size = UDim2.new(1, 0, 1, 0),
            Text = "",
            Parent = notification.NoBtn
        })
        
        noButton.MouseButton1Click:Connect(function()
            noCallback()
            notification:Dismiss()
        end)
    end
    
    table.insert(self.Notifications, notification)
    return notification
end

-- Config System
function Library:SaveConfig(name)
    local config = {}
    
    for flag, element in pairs(self.Flags) do
        if element.Value ~= nil then
            if typeof(element.Value) == "Color3" then
                config[flag] = {
                    Type = "Color3",
                    R = element.Value.R,
                    G = element.Value.G,
                    B = element.Value.B
                }
            elseif typeof(element.Value) == "EnumItem" then
                config[flag] = {
                    Type = "Enum",
                    EnumType = tostring(element.Value.EnumType),
                    Name = element.Value.Name
                }
            else
                config[flag] = {
                    Type = typeof(element.Value),
                    Value = element.Value
                }
            end
        end
    end
    
    local jsonConfig = HttpService:JSONEncode(config)
    
    if writefile then
        writefile("UILibrary_" .. name .. ".json", jsonConfig)
    end
    
    self.Configs[name] = config
    return config
end

function Library:LoadConfig(name)
    local config
    
    if readfile and isfile and isfile("UILibrary_" .. name .. ".json") then
        local jsonConfig = readfile("UILibrary_" .. name .. ".json")
        config = HttpService:JSONDecode(jsonConfig)
    elseif self.Configs[name] then
        config = self.Configs[name]
    else
        return false
    end
    
    for flag, data in pairs(config) do
        local element = self.Flags[flag]
        if element and element.Set then
            if data.Type == "Color3" then
                element:Set(Color3.new(data.R, data.G, data.B))
            elseif data.Type == "Enum" then
                element:Set(Enum[data.EnumType][data.Name])
            else
                element:Set(data.Value)
            end
        end
    end
    
    self.CurrentConfig = name
    return true
end

function Library:DeleteConfig(name)
    if delfile and isfile and isfile("UILibrary_" .. name .. ".json") then
        delfile("UILibrary_" .. name .. ".json")
    end
    self.Configs[name] = nil
end

function Library:SetAutoLoadConfig(name)
    self.AutoLoadConfig = name
    if writefile then
        writefile("UILibrary_AutoLoad.txt", name)
    end
end

function Library:GetAutoLoadConfig()
    if readfile and isfile and isfile("UILibrary_AutoLoad.txt") then
        return readfile("UILibrary_AutoLoad.txt")
    end
    return nil
end

function Library:LoadAutoConfig()
    local autoConfig = self:GetAutoLoadConfig()
    if autoConfig then
        return self:LoadConfig(autoConfig)
    end
    return false
end

-- Theme System
function Library:SaveTheme(name)
    local jsonTheme = HttpService:JSONEncode(Library.Theme)
    
    if writefile then
        writefile("UILibrary_Theme_" .. name .. ".json", jsonTheme)
    end
    
    return Library.Theme
end

function Library:LoadTheme(name)
    if readfile and isfile and isfile("UILibrary_Theme_" .. name .. ".json") then
        local jsonTheme = readfile("UILibrary_Theme_" .. name .. ".json")
        local theme = HttpService:JSONDecode(jsonTheme)
        
        for key, value in pairs(theme) do
            if typeof(value) == "table" and value.R then
                Library.Theme[key] = Color3.new(value.R, value.G, value.B)
            else
                Library.Theme[key] = value
            end
        end
        
        self:RefreshTheme()
        return true
    end
    return false
end

function Library:SetAutoLoadTheme(name)
    if writefile then
        writefile("UILibrary_AutoTheme.txt", name)
    end
end

function Library:LoadAutoTheme()
    if readfile and isfile and isfile("UILibrary_AutoTheme.txt") then
        local themeName = readfile("UILibrary_AutoTheme.txt")
        return self:LoadTheme(themeName)
    end
    return false
end

function Library:RefreshTheme()
    -- This would iterate through all created elements and update their colors
    -- Implementation depends on tracking all created instances
end

function Library:SetThemeValue(key, value)
    Library.Theme[key] = value
    self:RefreshTheme()
end

-- Destroy Library
function Library:Destroy()
    for _, connection in ipairs(self.Connections) do
        connection:Disconnect()
    end
    
    if self.ScreenGui then
        self.ScreenGui:Destroy()
    end
end

-- Return Library
return Library
